<%- include('partials/header', { title: 'Trang chủ', user: loggedInUser }) %>
<%- include('partials/navbar', { user: loggedInUser }) %>

<div class="container mx-auto">
    <h1 class="text-4xl font-extrabold text-center mb-10 text-primary">Bộ sưu tập Nước hoa</h1>

    <div class="flex flex-col md:flex-row gap-4 mb-8 p-4 bg-base-100 rounded-lg shadow-md">
        <form class="flex w-full gap-4" action="/" method="GET">
            <input type="text" placeholder="Tìm kiếm theo tên nước hoa..." name="search" class="input input-bordered flex-grow" value="<%= search || '' %>" />
            <select name="brandId" class="select select-bordered w-full md:w-1/4">
                <option value="">Lọc theo Thương hiệu</option>
                <% brands.forEach(brand => { %>
                    <option value="<%= brand._id %>" <%= brandId === brand._id.toString() ? 'selected' : '' %>><%= brand.brandName %></option>
                <% }) %>
            </select>
            <button type="submit" class="btn btn-secondary">Tìm kiếm</button>
        </form>
    </div>

    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
        <% perfumes.forEach(perfume => { %>
            <div class="card w-full bg-base-100 shadow-xl image-full group">
                <figure><img src="<%= perfume.uri %>" alt="<%= perfume.perfumeName %>" class="h-80 w-full object-cover group-hover:scale-105 transition duration-300"/></figure>
                <div class="card-body p-6 justify-end bg-black bg-opacity-30 group-hover:bg-opacity-50 transition duration-300">
                    
                    <h2 class="card-title text-3xl text-white font-serif">
                        <%= perfume.perfumeName %>
                        <% if (perfume.concentration === 'Extrait') { %>
                            <div class="badge badge-warning ml-2 p-3 text-lg">EXTRAIT ⭐</div>
                        <% } %>
                    </h2>
                    
                    <p class="text-white opacity-80">
                        Thương hiệu: **<%= perfume.brand.brandName %>** | Dành cho: <%= perfume.targetAudience %>
                    </p>
                    
                    <div class="card-actions justify-end mt-4">
                        <a href="/perfumes/<%= perfume._id %>" class="btn btn-secondary">
                            Xem Chi tiết
                        </a>
                    </div>
                </div>
            </div>
        <% }) %>
        <% if (perfumes.length === 0) { %>
            <div class="col-span-full alert alert-info">Không tìm thấy sản phẩm nào.</div>
        <% } %>
    </div>
</div>

<%- include('partials/footer') %>