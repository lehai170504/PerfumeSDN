<%- include('../partials/header', { title: 'Quản lý Thành viên', user:
loggedInUser }) %> <%- include('../partials/navbar', { user: loggedInUser }) %>

<div class="container mx-auto">
  <h1 class="text-3xl font-bold mb-6 text-primary">
    Danh sách Thành viên (Collectors)
  </h1>

  <% if (member.isAdmin) { %>
  <!-- Button mở modal -->
  <button id="openModalBtn" class="btn btn-primary mb-4">
    Thêm thành viên mới
  </button>

  <!-- Modal -->
  <div
    id="addMemberModal"
    class="fixed inset-0 bg-black bg-opacity-50 hidden justify-center items-center z-50"
  >
    <div class="bg-white rounded-lg w-96 p-6 relative">
      <h2 class="text-xl font-bold mb-4">Thêm Thành Viên Mới</h2>
      <form action="/auth/register" method="POST">
        <div class="mb-3">
          <label class="block mb-1">Email</label>
          <input
            type="email"
            name="email"
            class="input input-bordered w-full"
            required
          />
        </div>
        <div class="mb-3">
          <label class="block mb-1">Tên thành viên</label>
          <input
            type="text"
            name="membername"
            class="input input-bordered w-full"
            required
          />
        </div>
        <div class="mb-3">
          <label class="block mb-1">Mật khẩu</label>
          <input
            type="password"
            name="password"
            class="input input-bordered w-full"
            required
          />
        </div>
        <div class="mb-3">
          <label class="block mb-1">Role</label>
          <select name="isAdmin" class="select select-bordered w-full">
            <option value="false" selected>Member</option>
            <option value="true">Admin</option>
          </select>
        </div>
        <div class="flex justify-end mt-4">
          <button type="button" id="closeModalBtn" class="btn btn-outline mr-2">
            Hủy
          </button>
          <button type="submit" class="btn btn-primary">Thêm</button>
        </div>
      </form>
    </div>
  </div>
  <% } %>

  <div class="overflow-x-auto bg-base-100 p-6 rounded-lg shadow-xl">
    <table class="table w-full">
      <thead>
        <tr>
          <th>#</th>
          <th>Email</th>
          <th>Tên (membername)</th>
          <th>Role</th>
          <th>Ngày đăng ký</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody>
        <% members.forEach((memberItem, index) => { %>
        <tr class="hover">
          <th><%= index + 1 %></th>
          <td><%= memberItem.email %></td>
          <td><%= memberItem.name %></td>
          <td>
            <div
              class="badge <%= memberItem.isAdmin ? 'badge-error' : 'badge-info' %>"
            >
              <%= memberItem.isAdmin ? 'Admin' : 'Member' %>
            </div>
          </td>
          <td><%= new Date(memberItem.createdAt).toLocaleDateString() %></td>
          <td>
            <button class="btn btn-xs btn-warning mr-2" disabled>Edit</button>
            <button class="btn btn-xs btn-error" disabled>Delete</button>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <div role="alert" class="alert alert-info mt-6">
    <svg
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
      class="stroke-current shrink-0 w-6 h-6"
    >
      <path
        stroke-linecap="round"
        stroke-linejoin="round"
        stroke-width="2"
        d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"
      ></path>
    </svg>
    <span
      >Chỉ Admin mới có thể thêm thành viên. Ordinary members không được thao
      tác.</span
    >
  </div>
</div>

<%- include('../partials/footer') %>

<script>
  const modal = document.getElementById("addMemberModal");
  const openBtn = document.getElementById("openModalBtn");
  const closeBtn = document.getElementById("closeModalBtn");

  openBtn.addEventListener("click", () => {
    modal.classList.remove("hidden");
    modal.classList.add("flex");
  });

  closeBtn.addEventListener("click", () => {
    modal.classList.remove("flex");
    modal.classList.add("hidden");
  });

  // Click ra ngoài modal cũng đóng
  modal.addEventListener("click", (e) => {
    if (e.target === modal) {
      modal.classList.remove("flex");
      modal.classList.add("hidden");
    }
  });
</script>
