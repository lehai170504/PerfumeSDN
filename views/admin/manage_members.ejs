<%- include('../partials/header', { title: 'Quản lý Thành viên', user:
loggedInUser }) %> <%- include('../partials/navbar', { user: loggedInUser }) %>

<div class="container">
  <h1 class="page-title">Danh sách Thành viên (Collectors)</h1>

  <% if (messages && messages.length > 0) { %> <% messages.forEach(msg => { %>
  <div
    class="alert <%= msg.type === 'success' ? 'alert-success' : 'alert-error' %>"
  >
    <span><%= msg.text %></span>
  </div>
  <% }) %> <% } %> <% if (member.isAdmin) { %>
  <button id="openModalBtn" class="btn btn-primary">
    + Thêm thành viên mới
  </button>

  <div id="addMemberModal" class="modal">
    <div class="modal-content">
      <h2 class="modal-title">Đăng Ký Thành Viên Mới</h2>
      <form action="/auth/register" method="POST" class="form">
        <div class="form-group">
          <label>Email</label>
          <input type="email" name="email" placeholder="Nhập email" required />
        </div>

        <div class="form-group">
          <label>Tên thành viên</label>
          <input
            type="text"
            name="membername"
            placeholder="Nhập tên"
            required
          />
        </div>

        <div class="form-group">
          <label>Mật khẩu</label>
          <input
            type="password"
            name="password"
            placeholder="Đặt mật khẩu"
            required
          />
        </div>

        <div class="form-group">
          <label>Role</label>
          <select name="isAdmin">
            <option value="false" selected>Member (Thành viên)</option>
            <option value="true">Admin (Quản trị viên)</option>
          </select>
        </div>

        <div class="form-actions">
          <button type="button" id="closeModalBtn" class="btn btn-cancel">
            Hủy
          </button>
          <button type="submit" class="btn btn-primary">Thêm</button>
        </div>
      </form>
    </div>
  </div>
  <% } %>

  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Email</th>
          <th>Tên</th>
          <th>Role</th>
          <th>Ngày đăng ký</th>
        </tr>
      </thead>
      <tbody>
        <% members.forEach((memberItem, index) => { %>
        <tr>
          <td><%= index + 1 %></td>
          <td><%= memberItem.email %></td>
          <td><%= memberItem.name %></td>
          <td>
            <span
              class="<%= memberItem.isAdmin ? 'badge badge-admin' : 'badge badge-member' %>"
            >
              <%= memberItem.isAdmin ? 'Admin' : 'Member' %>
            </span>
          </td>
          <td>
            <%= new Date(memberItem.createdAt).toLocaleDateString('vi-VN') %>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <div class="alert alert-info mt-6">
    <span
      >Chỉ <b>Admin</b> mới có thể thêm thành viên. Ordinary members không được
      thao tác.</span
    >
  </div>
</div>

<%- include('../partials/footer') %>

<script>
  const modal = document.getElementById("addMemberModal");
  const openBtn = document.getElementById("openModalBtn");
  const closeBtn = document.getElementById("closeModalBtn");

  if (openBtn) {
    openBtn.addEventListener("click", () => {
      modal.style.display = "flex";
    });

    closeBtn.addEventListener("click", () => {
      modal.style.display = "none";
    });

    modal.addEventListener("click", (e) => {
      if (e.target === modal) {
        modal.style.display = "none";
      }
    });
  }
</script>
