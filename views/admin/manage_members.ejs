<%- include('../partials/header', { title: 'Quáº£n lÃ½ ThÃ nh viÃªn', user:
loggedInUser }) %> <%- include('../partials/navbar', { user: loggedInUser }) %>

<!-- ============================= -->
<!-- ðŸ‘¥ QUáº¢N LÃ THÃ€NH VIÃŠN -->
<!-- ============================= -->
<div class="members-container">
  <h1 class="page-title">Danh sÃ¡ch ThÃ nh viÃªn (Collectors)</h1>

  <!-- ThÃ´ng bÃ¡o -->
  <% if (messages) { %> <% if (messages.success && messages.success.length > 0)
  { %> <% messages.success.forEach(msg => { %>
  <div class="alert alert-success">
    <span><%= msg %></span>
  </div>
  <% }) %> <% } %> <% if (messages.error && messages.error.length > 0) { %> <%
  messages.error.forEach(msg => { %>
  <div class="alert alert-error">
    <span><%= msg %></span>
  </div>
  <% }) %> <% } %> <% } %> <% if (member.isAdmin) { %>
  <button id="openModalBtn" class="btn btn-secondary">
    + ThÃªm tÃ i khoáº£n Admin má»›i Â 
  </button>

  <!-- Modal thÃªm Admin -->
  <div id="addMemberModal" class="modal">
    <div class="modal-content">
      <h2 class="modal-title">ThÃªm TÃ i Khoáº£n Admin Má»›i</h2>

      <form
        id="addMemberForm"
        method="POST"
        action="/auth/admin"
        class="form-grid"
      >
        <div class="form-group full">
          <label for="email">Email</label>
          <input
            type="email"
            id="email"
            name="email"
            placeholder="Nháº­p email"
            required
          />
        </div>

        <div class="form-group full">
          <label for="name">TÃªn Admin</label>
          <input
            type="text"
            id="name"
            name="name"
            placeholder="Nháº­p tÃªn"
            required
          />
        </div>

        <div class="form-group">
          <label for="password">Máº­t kháº©u</label>
          <input
            type="password"
            id="password"
            name="password"
            placeholder="Äáº·t máº­t kháº©u"
            required
          />
        </div>

        <div class="form-group">
          <label>Role</label>
          <input type="text" value="Admin" disabled class="readonly" />
          <input type="hidden" name="isAdmin" value="true" />
        </div>

        <div class="modal-actions full">
          <button type="button" id="closeModalBtn" class="btn btn-light">
            Há»§y
          </button>
          <button type="submit" class="btn btn-secondary">Táº¡o Admin</button>
        </div>
      </form>
    </div>
  </div>
  <% } %>

  <!-- Báº£ng thÃ nh viÃªn -->
  <div class="table-container">
    <table class="data-table">
      <thead>
        <tr>
          <th>#</th>
          <th>Email</th>
          <th>TÃªn</th>
          <th>Role</th>
          <th>NgÃ y Ä‘Äƒng kÃ½</th>
        </tr>
      </thead>
      <tbody>
        <% members.forEach((memberItem, index) => { %>
        <tr>
          <td><%= index + 1 %></td>
          <td><%= memberItem.email %></td>
          <td><%= memberItem.name %></td>
          <td class="border px-4 py-2">
            <span
              class="badge <%= memberItem.isAdmin ? 'badge-admin' : 'badge-member' %>"
            >
              <%= memberItem.isAdmin ? 'Admin' : 'Member' %>
            </span>
          </td>

          <td>
            <%= new Date(memberItem.createdAt).toLocaleDateString('vi-VN') %>
          </td>
        </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
  <!-- Pagination -->
  <% if (totalPages > 1) { %>
  <div class="pagination">
    <% for (let i = 1; i <= totalPages; i++) { %>
    <a
      href="/admin/manage_members?page=<%= i %>"
      class="page-link <%= i === currentPage ? 'active' : '' %>"
    >
      <%= i %>
    </a>
    <% } %>
  </div>
  <% } %>

  <div class="alert alert-info">
    <span
      >Chá»‰ <b>Admin</b> má»›i cÃ³ thá»ƒ thÃªm thÃ nh viÃªn. Ordinary members khÃ´ng Ä‘Æ°á»£c
      thao tÃ¡c.</span
    >
  </div>
</div>

<%- include('../partials/footer') %>

<script>
  const modal = document.getElementById("addMemberModal");
  const openBtn = document.getElementById("openModalBtn");
  const closeBtn = document.getElementById("closeModalBtn");

  if (openBtn && modal && closeBtn) {
    openBtn.addEventListener("click", () => modal.classList.add("show"));
    closeBtn.addEventListener("click", () => modal.classList.remove("show"));
    modal.addEventListener("click", (e) => {
      if (e.target === modal) modal.classList.remove("show");
    });
  }
</script>
