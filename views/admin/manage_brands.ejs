<%- include('../partials/header', { title: 'Quản lý Thương hiệu', user:
loggedInUser }) %> <%- include('../partials/navbar', { user: loggedInUser }) %>

<link rel="stylesheet" href="manage-brands.css" />

<div class="brands-container">
  <h1 class="page-title">Quản lý Thương hiệu (Brands)</h1>

  <div class="action-bar">
    <button class="btn btn-secondary" onclick="openAddModal()">
      ➕ Thêm Thương hiệu Mới
    </button>
  </div>

  <% if (success && success.length > 0) { %>
  <div class="alert alert-success mb-4"><%= success[0] %></div>
  <% } %> <% if (error && error.length > 0) { %>
  <div class="alert alert-error mb-4"><%= error[0] %></div>
  <% } %>

  <div class="table-wrapper">
    <table class="brand-table">
      <thead>
        <tr>
          <th>STT</th>
          <th>Tên Thương hiệu</th>
          <th>Ngày Tạo</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody>
        <% if (brands.length === 0) { %>
        <tr>
          <td colspan="5" class="text-center">
            Chưa có thương hiệu nào được tạo.
          </td>
        </tr>
        <% } else { %> <% brands.forEach((brand, index) => { %>
        <tr>
          <td><%= index + 1 %></td>
          <td><%= brand.brandName %></td>
          <td><%= new Date(brand.createdAt).toLocaleDateString('vi-VN') %></td>
          <td class="action-buttons">
            <button
              class="btn btn-warning btn-xs"
              onclick="editBrand('<%= brand._id %>', '<%= brand.brandName %>')"
            >
              Sửa
            </button>

            <form
              action="/admin/brands/<%= brand._id %>?_method=DELETE"
              method="POST"
              onsubmit="return confirm('Bạn có chắc chắn muốn xóa thương hiệu <%= brand.brandName %>?');"
              class="inline"
            >
              <button type="submit" class="btn btn-danger btn-xs">Xóa</button>
            </form>
          </td>
        </tr>
        <% }) %> <% } %>
      </tbody>
    </table>

    <% if (totalPages > 1) { %>
    <div class="pagination">
      <% for (let i = 1; i <= totalPages; i++) { %>
      <a
        href="/admin/manage_brands?page=<%= i %>"
        class="page-link <%= i === currentPage ? 'active' : '' %>"
      >
        <%= i %>
      </a>
      <% } %>
    </div>
    <% } %>
  </div>

  <div class="alert alert-warning mt-6">
    ⚠️ Cẩn thận khi chỉnh sửa hoặc xóa thương hiệu — thao tác này ảnh hưởng đến
    sản phẩm liên quan.
  </div>
</div>

<!-- Modal Thêm Brand -->
<div id="addModal" class="modal">
  <div class="modal-content">
    <h3>Thêm Thương hiệu Mới</h3>
    <form action="/admin/brands" method="POST">
      <label for="brandName">Tên Thương hiệu</label>
      <input
        type="text"
        name="brandName"
        id="brandName"
        placeholder="VD: Chanel, Dior..."
        required
      />
      <div class="modal-actions">
        <button type="submit" class="btn btn-primary">Lưu</button>
        <button type="button" class="btn" onclick="closeAddModal()">Hủy</button>
      </div>
    </form>
  </div>
</div>

<!-- Modal Chỉnh sửa Brand -->
<div id="editModal" class="modal">
  <div class="modal-content">
    <h3>Chỉnh Sửa Thương hiệu</h3>
    <form id="editBrandForm" action="" method="POST">
      <input type="hidden" name="_method" value="PUT" />
      <label>ID Thương hiệu</label>
      <input type="text" id="editBrandIdDisplay" disabled />
      <label>Tên Thương hiệu Mới</label>
      <input type="text" id="editBrandNameInput" name="brandName" required />
      <div class="modal-actions">
        <button type="submit" class="btn btn-warning">Cập nhật</button>
        <button type="button" class="btn" onclick="closeEditModal()">
          Hủy
        </button>
      </div>
    </form>
  </div>
</div>

<script>
  function openAddModal() {
    document.getElementById("addModal").style.display = "flex";
  }
  function closeAddModal() {
    document.getElementById("addModal").style.display = "none";
  }

  function editBrand(id, name) {
    const form = document.getElementById("editBrandForm");
    form.action = `/admin/brands/${id}?_method=PUT`;
    document.getElementById("editBrandIdDisplay").value = id;
    document.getElementById("editBrandNameInput").value = name;
    document.getElementById("editModal").style.display = "flex";
  }
  function closeEditModal() {
    document.getElementById("editModal").style.display = "none";
  }

  // Đóng modal khi click ra ngoài
  window.onclick = function (e) {
    const add = document.getElementById("addModal");
    const edit = document.getElementById("editModal");
    if (e.target === add) add.style.display = "none";
    if (e.target === edit) edit.style.display = "none";
  };
</script>

<%- include('../partials/footer') %>
