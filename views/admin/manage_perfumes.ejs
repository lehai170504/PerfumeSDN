<%- include('../partials/header', { title: 'Quản lý Nước hoa', user:
loggedInUser }) %> <%- include('../partials/navbar', { user: loggedInUser }) %>

<div class="container">
  <h1 class="page-title">Quản lý Nước hoa (Perfumes)</h1>

  <div class="top-bar">
    <span class="count">
      Tổng số:
      <strong> <%= perfumes.filter(p => !p.isDeleted).length %> </strong>
      sản phẩm
    </span>

    <button
      class="btn btn-secondary"
      onclick="document.getElementById('add_perfume_modal').showModal()"
    >
      ➕ Thêm Nước hoa Mới
    </button>
  </div>

  <% if (success && success.length > 0) { %>
  <div class="alert alert-success">
    <span><%= success[0] %></span>
  </div>
  <% } %> <% if (error && error.length > 0) { %>
  <div class="alert alert-error">
    <span><%= error[0] %></span>
  </div>
  <% } %>

  <div class="table-wrapper">
    <table class="perfume-table">
      <thead>
        <tr>
          <th>STT</th>
          <th>Ảnh</th>
          <th>Tên Nước hoa</th>
          <th>Giá</th>
          <th>Brand</th>
          <th>Concentration</th>
          <th>Hành động</th>
        </tr>
      </thead>
      <tbody>
        <% const activePerfumes = perfumes.filter(p => !p.isDeleted); if
        (activePerfumes.length === 0) { %>
        <tr>
          <td colspan="7" class="text-center text-muted">
            Chưa có nước hoa nào được tạo hoặc đã bị ẩn.
          </td>
        </tr>
        <% } else { activePerfumes.forEach((perfume, index) => { %>
        <tr>
          <td><%= index + 1 %></td>
          <td>
            <img
              src="<%= perfume.uri %>"
              alt="<%= perfume.perfumeName %>"
              class="thumb"
            />
          </td>
          <td><strong><%= perfume.perfumeName %></strong></td>
          <td><%= perfume.price.toLocaleString('vi-VN') %> VNĐ</td>
          <td><%= perfume.brand?.brandName || 'Không xác định' %></td>
          <td>
            <span
              class="badge <%= perfume.concentration === 'Extrait' ? 'badge-warning' : 'badge-info' %>"
            >
              <%= perfume.concentration %>
            </span>
          </td>
          <td>
            <div class="action-buttons">
              <button
                class="btn btn-warning btn-xs"
                onclick="editPerfume('<%= JSON.stringify(perfume) %>')"
              >
                Sửa
              </button>

              <form
                action="/admin/perfumes/<%= perfume._id %>?_method=DELETE"
                method="POST"
                class="inline-form"
                onsubmit="return confirm('Xác nhận xóa nước hoa <%= perfume.perfumeName %>?');"
              >
                <button type="submit" class="btn btn-error btn-xs">Xóa</button>
              </form>
            </div>
          </td>
        </tr>
        <% }) } %>
      </tbody>
    </table>

    <% if (totalPages > 1) { %>
    <div class="pagination flex justify-center gap-2 mt-6">
      <% for (let i = 1; i <= totalPages; i++) { %>
      <a
        href="/admin/manage_perfumes?page=<%= i %>"
        class="btn btn-sm <%= currentPage === i ? 'btn-active btn-primary' : 'btn-outline' %>"
      >
        <%= i %>
      </a>
      <% } %>
    </div>
    <% } %>
  </div>
</div>

<!-- Modal thêm & chỉnh sửa giữ nguyên -->
<%- include('../partials/footer') %>
